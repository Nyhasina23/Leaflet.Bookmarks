<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Leaflet.Bookmarks by w8r</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/aratcliffe/Leaflet.contextmenu/master/dist/leaflet.contextmenu.css">
    <link rel="stylesheet" type="text/css" href="https://rawgit.com/w8r/Leaflet.Bookmarks/master/dist/leaflet.bookmarks.css">
    <style type="text/css">
    #map {
        width: 100%;
        height: 500px;
        display: block;
    }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script type="text/javascript" src="https://cdn.rawgit.com/ded/reqwest/master/reqwest.min.js"></script>
    <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/aratcliffe/Leaflet.contextmenu/master/dist/leaflet.contextmenu-src.js"></script>
    <script type="text/javascript" src="https://rawgit.com/w8r/Leaflet.Bookmarks/master/dist/L.Control.Bookmarks.js"></script>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Leaflet.Bookmarks</h1>
        <p>Leaflet control for user-generated bookmarks</p>

        <p class="view"><a href="https://github.com/w8r/Leaflet.Bookmarks">View the Project on GitHub <small>w8r/Leaflet.Bookmarks</small></a></p>


        <ul>
          <li><a href="https://github.com/w8r/Leaflet.Bookmarks/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/w8r/Leaflet.Bookmarks/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/w8r/Leaflet.Bookmarks">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>
<a name="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages"><span class="octicon octicon-link"></span></a>Leaflet Bookmarks</h2>

<p>This is a highly customizable plugin for leaflet to allow users to drop bookmarks on your map and to store them locally or on server. It uses localstorage by default, but allows you to implement your own storage solution. You can also redefine the addition of bookmarks, their looks and fields.</p>

<p>Right-click on the map, to add a new bookmark</p>
<div id="map"></div>

<h2>Usage</h2>
  <h3>Includes</h3>
  <div class="highlight highlight-html">
    <pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/path/to/leaflet.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/path/to/Leaflet.Bookmarks.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;link</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"/path/to/leaflet.bookmarks.css"</span><span class="nt">&gt;</span>
</pre>
  </div>
  <h3>Put control on the map</h3>
  <div class="highlight highlight-js">
    <pre><span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Map</span><span class="p">(...);</span>
<span class="kd">var</span> <span class="nx">control</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">Bookmarks</span><span class="p">().</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
</pre>
  </div>
  <h3>Adding a bookmark</h3>
  <p>How you trigger a bookmark addition is your own choice. For the demo I used the beautiful <a href="https://github.com/aratcliffe/Leaflet.contextmenu">Leaflet.contextmenu</a> plugin by <a href="https://github.com/aratcliffe" class="user-mention">@aratcliffe</a>, but you are free to take any approach you want - it's based on the event <code>bookmark:new</code> dispatched by the map instance:</p>
  <div class="highlight highlight-js">
    <pre><span class="nx">map</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">'bookmark:new'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">latlng</span><span class="o">:</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(...,</span> <span class="p">...)</span>
<span class="p">});</span>
</pre>
  </div>
  <p>If you want you can omit the naming step and add a bookmark straight to the list using a <code>bookmark:add</code> event.</p>
  <div class="highlight highlight-js">
    <pre><span class="nx">map</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">'bookmark:add'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">'XXXX'</span> <span class="c1">// make sure it's unique,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">'Bookmark name'</span><span class="p">,</span>
    <span class="nx">latlng</span><span class="o">:</span> <span class="p">[</span><span class="nx">lat</span><span class="p">,</span> <span class="nx">lng</span><span class="p">]</span> <span class="c1">// important, we're dealing with JSON here,</span>
    <span class="nx">your_key</span><span class="o">:</span> <span class="s1">'your value'</span>
<span class="p">});</span>
</pre>
  </div>
  <h2>Customizing</h2>
  <h3>
    <code>localStorage</code> or variable storage
  </h3>
  <p>The control uses <code>localStorage</code> by default. Your bookmarks will be stored in prefixed key-value pairs. You can customize the prefix if you want to</p>
  <pre><code>var control = new L.Control.Bookmarks({
    name: 'your-storage-prefix', // defaults to 'leaflet-bookmarks'
    localStorage: false // if you want to use local variable for storage
});
</code></pre>
  <p>P.S. You can access the storage directly through the control:</p>
  <div class="highlight highlight-js">
    <pre><span class="nx">control</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">control</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">control</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="nx">control</span><span class="p">.</span><span class="nx">_storage</span><span class="p">.</span><span class="nx">getAllItems</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</pre>
  </div>
  <h3>Custom storage(e.g AJAX)</h3>
  <p>I intentionally didn't add an engine for anything else than <code>localStorage</code> and local variable storage, so you could use your own xhr functions. To do that, you have to pass the interface to your storage to the control like this:</p>
  <div class="highlight highlight-js">
    <pre><span class="kd">var</span> <span class="nx">control</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">Bookmarks</span><span class="p">({</span>
    <span class="nx">storage</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">getItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s1">'/bookmarks/'</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
                <span class="nx">dataType</span><span class="o">:</span> <span class="s1">'json'</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">callback</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">setItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s1">'/bookmarks/'</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">'PUT'</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
                <span class="nx">dataType</span><span class="o">:</span> <span class="s1">'json'</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">callback</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">removeItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s1">'/bookmarks/'</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
                <span class="nx">dataType</span><span class="o">:</span> <span class="s1">'json'</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">callback</span>
            <span class="p">});</span>
        <span class="p">},</span>
        <span class="nx">getAllItems</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="nx">url</span><span class="o">:</span> <span class="s1">'/bookmarks/'</span><span class="p">,</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">'GET'</span><span class="p">,</span>
                <span class="nx">dataType</span><span class="o">:</span> <span class="s1">'json'</span><span class="p">,</span>
                <span class="nx">success</span><span class="o">:</span> <span class="nx">callback</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}).</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
</pre>
  </div>
  <h3>Custom templates</h3>
  <p>Pass those into the options if you want to customize the popup or list templates. Proceed with caution</p>
  <div class="highlight highlight-js">
    <pre><span class="p">{</span>
       <span class="c1">// list item MUST contain `data-id` attribute,</span>
       <span class="c1">// or provide your own `options.getBookmarkFromListItem(listItem)` method</span>
       <span class="nx">bookmarkTemplate</span><span class="o">:</span> <span class="s1">'&lt;li class="{{ itemClass }}" data-id="{{ data.id }}"&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;span class="{{ removeClass }}"&gt;&amp;times;&lt;/span&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;span class="{{ nameClass }}"&gt;{{ data.name }}&lt;/span&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;span class="{{ coordsClass }}"&gt;{{ data.coords }}&lt;/span&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;/li&gt;'</span><span class="p">,</span>

        <span class="c1">// format list item name</span>
        <span class="nx">formatName</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span> <span class="p">...</span> <span class="p">},</span>

        <span class="c1">// format coords</span>
        <span class="c1">// again, you have access to the control here, so you can</span>
        <span class="c1">// output projected coords for example</span>
        <span class="nx">formatCoords</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">laltlng</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">projected</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_map</span><span class="p">.</span><span class="nx">project</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">latLng</span><span class="p">(</span><span class="nx">latlng</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">latlng</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
            <span class="k">return</span> <span class="s1">'X: '</span> <span class="o">+</span> <span class="nx">projected</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s1">'m, Y: '</span> <span class="o">+</span> <span class="nx">projected</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s1">'m'</span><span class="p">;</span>
        <span class="p">},</span>

        <span class="c1">// no bookmarks yet</span>
        <span class="nx">emptyTemplate</span><span class="o">:</span> <span class="s1">'&lt;li class="{{ itemClass }} {{ emptyClass }}"&gt;'</span> <span class="o">+</span>
            <span class="s1">'{{ data.emptyMessage }}&lt;/li&gt;'</span><span class="p">,</span>

        <span class="c1">// no bookmarks text</span>
        <span class="nx">emptyMessage</span><span class="o">:</span> <span class="s2">"Hell no, I forgot where I've been!"</span><span class="p">,</span>

        <span class="c1">// you can change them, but then provide your own styling</span>
        <span class="nx">bookmarkTemplateOptions</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">itemClass</span><span class="o">:</span> <span class="s1">'bookmark-item'</span><span class="p">,</span>
            <span class="nx">nameClass</span><span class="o">:</span> <span class="s1">'bookmark-name'</span><span class="p">,</span>
            <span class="nx">coordsClass</span><span class="o">:</span> <span class="s1">'bookmark-coords'</span><span class="p">,</span>
            <span class="nx">removeClass</span><span class="o">:</span> <span class="s1">'bookmark-remove'</span><span class="p">,</span>
            <span class="nx">emptyClass</span><span class="o">:</span> <span class="s1">'bookmarks-empty'</span>
        <span class="p">},</span>

        <span class="c1">// change that if you have custom fields in your bookmarks</span>
        <span class="nx">popupTemplate</span><span class="o">:</span> <span class="s1">'&lt;div&gt;&lt;h3&gt;{{ name }}&lt;/h3&gt;&lt;p&gt;{{ latlng }}&lt;/p&gt;'</span><span class="p">,</span>

        <span class="c1">// here you extract them for the template. </span>
        <span class="c1">// note - you have access to controls methods and fields here</span>
        <span class="nx">getPopupContent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bookmark</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">popupTemplate</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">latlng</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">formatCoords</span><span class="p">(</span><span class="nx">bookmark</span><span class="p">.</span><span class="nx">latlng</span><span class="p">),</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">bookmark</span><span class="p">.</span><span class="nx">name</span>
            <span class="p">});</span>
        <span class="p">},</span>

        <span class="c1">// here you can filter bookmarks that you get from</span>
        <span class="c1">// the storage or a user, make sure it returns an Array</span>
        <span class="nx">filterBookmarks</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bookmarks</span><span class="p">){</span> <span class="p">...</span> <span class="p">},</span>
<span class="p">}</span>
</pre>
  </div>
  <p>You can customize the bookmark add form too, pass that to the control options:</p>
  <div class="highlight highlight-js">
    <pre><span class="nx">formPopup</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">className</span><span class="o">:</span> <span class="s1">'leaflet-bookmarks-form-popup'</span><span class="p">,</span>
        <span class="nx">templateOptions</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">formClass</span><span class="o">:</span> <span class="s1">'leaflet-bookmarks-form'</span><span class="p">,</span>
            <span class="nx">inputClass</span><span class="o">:</span> <span class="s1">'leaflet-bookmarks-form-input'</span><span class="p">,</span>
            <span class="nx">coordsClass</span><span class="o">:</span> <span class="s1">'leaflet-bookmarks-form-coords'</span><span class="p">,</span>
            <span class="nx">submitClass</span><span class="o">:</span> <span class="s1">'leaflet-bookmarks-form-submit'</span><span class="p">,</span>
            <span class="nx">inputPlaceholder</span><span class="o">:</span> <span class="s1">'Bookmark name'</span><span class="p">,</span>
            <span class="nx">submitText</span><span class="o">:</span> <span class="s1">'+'</span>
        <span class="p">},</span>
        <span class="nx">getBookmarkData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_contentNode</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.'</span> <span class="o">+</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">templateOptions</span><span class="p">.</span><span class="nx">inputClass</span><span class="p">);</span>
            <span class="p">...</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="s1">'YOUR_UNIQUE_ID'</span><span class="p">,</span>
                <span class="nx">name</span><span class="o">:</span> <span class="s1">'Bookmark name'</span><span class="p">,</span>
                <span class="nx">your_custom_field</span><span class="o">:</span> <span class="p">...</span> <span class="c1">// get it from the form inputs</span>
                <span class="nx">latlng</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_source</span><span class="p">.</span><span class="nx">getLatLng</span><span class="p">()</span> <span class="c1">// get it from the marker</span>
            <span class="p">};</span>
        <span class="p">},</span>
        <span class="nx">generateNames</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// generate unique name if it's not provided by the user</span>
        <span class="nx">generateNamesPrefix</span><span class="o">:</span> <span class="s1">'Bookmark '</span><span class="p">,</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">'&lt;form class="{{ formClass }}"&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;input type="text" name="bookmark-name" '</span> <span class="o">+</span>
            <span class="s1">'placeholder="{{ inputPlaceholder }}" class="{{ inputClass }}"&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;input type="submit" value="{{ submitText }}" '</span> <span class="o">+</span>
            <span class="s1">'class="{{ submitClass }}"&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;div class="{{ coordsClass }}"&gt;{{ coords }}&lt;/div&gt;'</span> <span class="o">+</span>
            <span class="s1">'&lt;/form&gt;'</span>
    <span class="p">}</span>
</pre>
  </div>
  <h4><code>L.Util._template</code></h4>
  <p>Small template function used by this project. It's a simple implementation of <a href="https://github.com/lodash" class="user-mention">@lodash</a> templates, using <strong>mustache</strong> interpolation syntax. You get it as a souvenir.</p>
  <div class="highlight highlight-js">
    <pre><span class="nx">L</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">_template</span><span class="p">(</span><span class="s1">'Whereof one cannot {{ data.action }}, thereof one must keep {{ data.instead }}'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">action</span><span class="o">:</span> <span class="s1">'speak'</span><span class="p">,</span> <span class="nx">instead</span><span class="o">:</span> <span class="s1">'silent'</span> <span class="p">}});</span>
<span class="c1">// -&gt; "Whereof one cannot speak, thereof one must keep silent"</span>
</pre>
  </div>

<h3><a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p><a href="https://github.com/w8r/" class="user-mention">Alexander Milevski</a></p>

<h3>License</h3>
<p>MIT</p>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/w8r">w8r</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    <script src="javascripts/page.js"></script>
  </body>
</html>
